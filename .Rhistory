b.s_t<-lm((nni-inc)~factor(nat)+gdp,data = dta[dta$pit>s & dta$pit<f,])
b.s[3]=b.s_t$coefficients['gdp']
b.s_s<-lm((inc-con)~factor(nat)+gdp,data = dta[dta$pit>s & dta$pit<f,])
b.s[4]=b.s_s$coefficients['gdp']
b.s_u<-lm(con~factor(nat)+gdp,data = dta[dta$pit>s & dta$pit<f,])
b.s[5]=b.s_u$coefficients['gdp']
B.s[t,]=b.s
}
b.labs=c('b_f','b_d','b_t','b_s','b_u')
B=data.frame(B)
colnames(B)=b.labs
plot(B) # interesting???
b.labs=c('b_f','b_d','b_t','b_s','b_u')
B.s=data.frame(B.s)
colnames(B.s)=b.labs
plot(B.s) # interesting???
plot(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B$b_f,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'blue')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B$b_d,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'black')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B$b_t,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'orange')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B$b_s,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'green')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B$b_u,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'red')
title('Channel contributions over time (triple interaction estimation, measures at zero)')
legend(x = c(as.Date("2008/1/1"), as.Date("2009/1/1")), y = c(0.725, 1),legend = c('b_f','b_d','b_t','b_s', 'b_u'),col = c('blue','black','orange','green','red'),lty = c(1,1))
abline(v=as.Date("2009/10/01"))
abline(v=as.Date("2020/04/01"))
plot(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B.s$b_f,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'blue')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B.s$b_d,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'black')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B.s$b_t,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'orange')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B.s$b_s,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'green')
lines(seq(as.Date("2008/1/1"), as.Date("2020/12/31"), by = "quarter"),B.s$b_u,type = 'l',ylab = 'beta',xlab = 'Year',ylim = c(-0.5,1),col = 'red')
title('Channel contributions over time (simple estimation, no covid controll vars)')
legend(x = c(as.Date("2008/1/1"), as.Date("2009/1/1")), y = c(0.725, 1),legend = c('b_f','b_d','b_t','b_s', 'b_u'),col = c('blue','black','orange','green','red'),lty = c(1,1))
abline(v=as.Date("2009/10/01"))
abline(v=as.Date("2020/04/01"))
# static point of view
s=0 # s+1 = starting point in time
f=57 # l-1 = end point in time
# use pit.to.q to translate point in time to actual dates
# pit.to.q=data.frame('pit'=1:52,'qtr'=seq(as.Date("2006/4/1"), as.Date("2020/12/31"), by = "quarter"))
b=c()
b_f<-lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data = dta[dta$pit>s & dta$pit<f,])
summary(b_f)
b[1]=b_f$coefficients['gdp']
b_d<-lm((gni-nni)~factor(nat)+ic+gdp*mc*ps,data = dta[dta$pit>s & dta$pit<f,])
summary(b_d)
b[2]=b_d$coefficients['gdp']
b_t<-lm((nni-inc)~factor(nat)+ic+gdp*mc*ps,data = dta[dta$pit>s & dta$pit<f,])
summary(b_t)
b[3]=b_t$coefficients['gdp']
b_s<-lm((inc-con)~factor(nat)+ic+gdp*mc*ps,data = dta[dta$pit>s & dta$pit<f,])
summary(b_s)
b[4]=b_s$coefficients['gdp']
b_u<-lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$pit>s & dta$pit<f,])
summary(b_u)
b[5]=b_u$coefficients['gdp']
b
sum(b)
###################################################################################################################
############################## end of estimations #################################################################
###################################################################################################################
############################## sample selection vector to make sure tilde is right ################################
tmp.sel=1:22*(c('as','au','be','br','cd','cz','dn','fn','fr','ge','gr','it','jp','nl','nw','po','ru','sp','sw','tk','uk','us') %in% codes)
tmp.sel=tmp.sel[tmp.sel>0]
stargazer(r.s.c.1,coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = 'text',title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
source('C:/Users/BongBong/Desktop/nat_ac/pre_reg.R')
source('C:/Users/BongBong/Desktop/nat_ac/pre_reg.R')
output='text' # latex or text in console
stargazer(r.s.c.1,coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
stargazer(coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Net disp. Income',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
?stargazer
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?',out.header = 0)
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?',out.header = FALSE)
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?',table.layout = "#tn")
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'Simple regression: Consumption',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: \tilde{consumption} = national fixed effects + \tilde{GDP}',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: \tilde{disposable income} = national fixed effects + \tilde{GDP}',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
output='latex' # latex or text in console
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: \tilde{consumption} = national fixed effects + \tilde{GDP}',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: \\tilde{consumption} = national fixed effects + \tilde{GDP}',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: \ \tilde{consumption} = national fixed effects + \tilde{GDP}',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: consumption = national fixed effects + GDP',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: disposable income = national fixed effects + GDP',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: disposable income = country fixed effects + GDP',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects?')
stargazer(coeftest(r.i.c.1,vcovCL,cluster=dta[,c('nat','year')]),type = 'text',title = 'OLS: consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
stargazer(coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = 'text',title = 'OLS: dispolable income = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
stargazer(coeftest(r.i.c.1,vcovCL,cluster=dta[,c('nat','year')]),coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = 'text',title = 'OLS: X = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
# 4
Consumption<-coeftest(r.i.c.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')]),type = 'text',title = 'OLS: X = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
Disposable_Income<-coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,Disposable_Income,type = 'text',title = 'OLS: X = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects')
stargazer(Consumption,Disposable_Income,type = 'text',title = 'OLS: Y = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('Y=Consumption','Y=Disposable Income'))
Consumption<-coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')])
Disposable_Income<-coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,Disposable_Income,type = 'text',title = 'OLS: Y = country fixed effects + GDP',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('Y=Consumption','Y=Disposable Income'))
# 3 plot of dynamics of simple regressions
# 4
Consumption<-coeftest(r.i.c.1,vcovCL,cluster=dta[,c('nat','year')])
Disposable_Income<-coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,Disposable_Income,type = 'text',title = 'OLS: Y = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('Y=Consumption','Y=Disposable Income'))
Consumption<-coeftest(r.s.c.1,vcovCL,cluster=dta[,c('nat','year')])
Disposable_Income<-coeftest(r.s.i.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,Disposable_Income,type = output,title = 'OLS: Y = country fixed effects + GDP',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('Y=Consumption','Y=Disposable Income'))
# 3 plot of dynamics of simple regressions
# 4
Consumption<-coeftest(r.i.c.1,vcovCL,cluster=dta[,c('nat','year')])
Disposable_Income<-coeftest(r.i.i.1,vcovCL,cluster=dta[,c('nat','year')])
stargazer(Consumption,Disposable_Income,type = output,title = 'OLS: Y = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('Y=Consumption','Y=Disposable Income'))
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output)
sub.dta=dta[dta$pit>55,c('pit','nat','mc','ps')]
corrs<-data.frame(sub.dta[1:4,3:4])
for(i in 2:13){
corrs<-data.frame(corrs,sub.dta[(1+4*(i-1)):(4+4*(i-1)),3:4])
}
ratio<-rbind(names,colMeans(corrs)[seq(1,26,2)]/colMeans(corrs)[seq(2,26,2)])
subsam<-ratio[2,]>1
othsam<-ratio[2,]<=1
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output)
output='text' # latex or text in console
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output)
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high measures to support','low measures to support','all'))
stargazer(coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output,title = 'OLS: Disposable Income = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high measures to support','low measures to support','all'))
output='latex' # latex or text in console
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(con~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high measures to support','low measures to support','all'))
stargazer(coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[subsam],]),vcovCL,cluster=dta[dta$nat %in% codes[subsam],][,c('nat','year')]),coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes[othsam],]),vcovCL,cluster=dta[dta$nat %in% codes[othsam],][,c('nat','year')]),coeftest(lm(inc~factor(nat)+ic+gdp*mc*ps,data = dta[dta$nat %in% codes,]),vcovCL,cluster=dta[dta$nat %in% codes,][,c('nat','year')]),type=output,title = 'OLS: Disposable Income = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high measures to support','low measures to support','all'))
stargazer(b_f,b_d,d_t,b_s,b_u,type = output,title = 'OLS: Channel decomposition',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('b_f','b_d','b_t','b_s','b_u'))
stargazer(b_f,b_d,b_t,b_s,b_u,type = output,title = 'OLS: Channel decomposition',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('b_f','b_d','b_t','b_s','b_u'))
coeftest(b_f,vcovCL,cluster=dta[,c('nat','year')])
stargazer(coeftest(b_f,vcovCL,cluster=dta[,c('nat','year')]),coeftest(b_d,vcovCL,cluster=dta[,c('nat','year')]),coeftest(b_t,vcovCL,cluster=dta[,c('nat','year')]),coeftest(b_s,vcovCL,cluster=dta[,c('nat','year')]),coeftest(b_u,vcovCL,cluster=dta[,c('nat','year')]),type = output,title = 'OLS: Channel decomposition',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('b_f','b_d','b_t','b_s','b_u'))
source('C:/Users/BongBong/Desktop/nat_ac/cross_border.R')
mr_raw<-read_xlsx('C:/Users/BongBong/Desktop/nat_ac/OxCGRT_data/OxCGRT_timeseries_all.xlsx',sheet = 'c7_movementrestrictions') # movement restrictions
cb_raw<-read_xlsx("C:/Users/BongBong/Desktop/nat_ac/eurostat_data/LFSQ_EGAN__custom_10069781622282993343.xlsx",sheet = 3)[-c(1:10,37:41),]
cb=cb_raw[,is.na(c(cb_raw[1,]))==0&c(cb_raw[1,])!='b']
cb_f=cb[cb$...2=='Foreign country',-(1:2)]
cb_t=cb[cb$...2=='Total',-(1:2)]
sfe=to.num(cb_f)/to.num(cb_t)
means_cb<-cbind(names,rowMeans(sfe))
cut_off<-mean(rowMeans(sfe[-3,]))
sel_cb<-rowMeans(sfe)>cut_off
so<-(sel_cb*1:13)[sel_cb]
so<-c(na.omit(so))
sel_cb<-rowMeans(sfe)<cut_off
st<-(sel_cb*1:13)[sel_cb]
st<-c(na.omit(st))
plot(colMeans(sfe[-3,])) # with out denmark due to missing values
matplot(sfe[-3,],type = 'l')
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type = output)
# corssboarder working and investment flows might correlated
######################## use goverment response index #########################
dcb_raw<-read_xlsx('C:/Users/BongBong/Desktop/nat_ac/OxCGRT_data/OxCGRT_timeseries_all.xlsx',sheet = 'c8_internationaltravel') # international movement restrictions
dcb<-dcb_raw[dcb_raw$country_name %in% names,]   # here alphabetical ordering becomes importand
dcb.2020<-dcb[, -grep("2021", colnames(dcb))]
dcb.q1<-rowMeans(dcb.2020[,c(grep("Jan", colnames(dcb.2020)),grep("Feb", colnames(dcb.2020)),grep("Mar", colnames(dcb.2020)))]==4)
dcb.q2<-rowMeans(dcb.2020[,c(grep("Apr", colnames(dcb.2020)),grep("May", colnames(dcb.2020)),grep("Jun", colnames(dcb.2020)))]==4)
dcb.q3<-rowMeans(dcb.2020[,c(grep("Jul", colnames(dcb.2020)),grep("Aug", colnames(dcb.2020)),grep("Sep", colnames(dcb.2020)))]==4)
dcb.q4<-rowMeans(dcb.2020[,c(grep("Oct", colnames(dcb.2020)),grep("Nov", colnames(dcb.2020)),grep("Dec", colnames(dcb.2020)))]==4)
dta$dcb=0
k=0
for (i in codes[1:obs]) {
k=k+1
dta[dta$nat==i & dta$pit==56,'dcb']=dcb.q1[k]
dta[dta$nat==i & dta$pit==57,'dcb']=dcb.q2[k]
dta[dta$nat==i & dta$pit==58,'dcb']=dcb.q3[k]
dta[dta$nat==i & dta$pit==59,'dcb']=dcb.q4[k]
}
cor(dta[dta$pit>55,-(1:2)])
cor(dta[dta$pit>55 & dta$nat %in% codes[so],-(1:2)])
dcb.reg<-lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta) # year fe do not change anything
stargazer(coeftest(dcb.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
dcb.means=colMeans(dta[dta$dcb>=1/2,-(1:2)],na.rm = TRUE)
ndcb.means=colMeans(dta[dta$dcb<1/2,-(1:2)],na.rm = TRUE)
dcb.bf<-dcb.reg$coefficients['gdp']+dcb.reg$coefficients['gdp:ps']*dcb.means['ps']+dcb.reg$coefficients['gdp:dcb']*dcb.means['dcb']+dcb.reg$coefficients['gdp:dcb:ps']*dcb.means['ps']*dcb.means['dcb']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been closed", dcb.bf)
ndcb.bf<-dcb.reg$coefficients['gdp']+dcb.reg$coefficients['gdp:ps']*ndcb.means['ps']+dcb.reg$coefficients['gdp:dcb']*ndcb.means['dcb']+dcb.reg$coefficients['gdp:dcb:ps']*ndcb.means['ps']*ndcb.means['dcb']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been open", ndcb.bf)
# alternative explaination, countries with less benefit from cross border traffic are more likely to close borders
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
# sort(lm.influence(dcb.reg)$coefficients[,'gdp:dcb'],decreasing = TRUE)
###### redo exercise for internal movement restrictions ###############################################################
######################## use goverment response index #########################
mr_raw<-read_xlsx('C:/Users/BongBong/Desktop/nat_ac/OxCGRT_data/OxCGRT_timeseries_all.xlsx',sheet = 'c7_movementrestrictions') # movement restrictions
mr<-mr_raw[mr_raw$country_name %in% names,]   # here alphabetical ordering becomes importand
mr.2020<-mr[, -grep("2021", colnames(mr))]
mr.q1<-rowMeans(mr.2020[,c(grep("Jan", colnames(mr.2020)),grep("Feb", colnames(mr.2020)),grep("Mar", colnames(mr.2020)))]==2)
mr.q2<-rowMeans(mr.2020[,c(grep("Apr", colnames(mr.2020)),grep("May", colnames(mr.2020)),grep("Jun", colnames(mr.2020)))]==2)
mr.q3<-rowMeans(mr.2020[,c(grep("Jul", colnames(mr.2020)),grep("Aug", colnames(mr.2020)),grep("Sep", colnames(mr.2020)))]==2)
mr.q4<-rowMeans(mr.2020[,c(grep("Oct", colnames(mr.2020)),grep("Nov", colnames(mr.2020)),grep("Dec", colnames(mr.2020)))]==2)
dta$mr=0
k=0
for (i in codes[1:obs]) {
k=k+1
dta[dta$nat==i & dta$pit==56,'mr']=mr.q1[k]
dta[dta$nat==i & dta$pit==57,'mr']=mr.q2[k]
dta[dta$nat==i & dta$pit==58,'mr']=mr.q3[k]
dta[dta$nat==i & dta$pit==59,'mr']=mr.q4[k]
}
cor(dta[dta$pit>55,-(1:2)])
cor(dta[dta$pit>55 & dta$nat %in% codes[so],-(1:2)])
mr.reg<-lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta) # year fe do not change anything
stargazer(coeftest(mr.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
mr.means=colMeans(dta[dta$mr>=1/2,-(1:2)],na.rm = TRUE)
nmr.means=colMeans(dta[dta$mr<1/2,-(1:2)],na.rm = TRUE)
mr.bf<-mr.reg$coefficients['gdp']+mr.reg$coefficients['gdp:ps']*mr.means['ps']+mr.reg$coefficients['gdp:mr']*mr.means['mr']+mr.reg$coefficients['gdp:mr:ps']*mr.means['ps']*mr.means['mr']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been closed", mr.bf)
nmr.bf<-mr.reg$coefficients['gdp']+mr.reg$coefficients['gdp:ps']*nmr.means['ps']+mr.reg$coefficients['gdp:mr']*nmr.means['mr']+mr.reg$coefficients['gdp:mr:ps']*nmr.means['ps']*nmr.means['mr']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been open", nmr.bf)
# alternative explaination, countries with less benefit from cross border traffic are more likely to close borders
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mr*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
# for fgl_us
mr.reg<-lm(inc~factor(nat)+ic+gdp*mr*ps,data=dta) # year fe do not change anything
stargazer(coeftest(mr.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
output='text'
cb_raw<-read_xlsx("C:/Users/BongBong/Desktop/nat_ac/eurostat_data/LFSQ_EGAN__custom_10069781622282993343.xlsx",sheet = 3)[-c(1:10,37:41),]
cb=cb_raw[,is.na(c(cb_raw[1,]))==0&c(cb_raw[1,])!='b']
cb_f=cb[cb$...2=='Foreign country',-(1:2)]
cb_t=cb[cb$...2=='Total',-(1:2)]
sfe=to.num(cb_f)/to.num(cb_t)
means_cb<-cbind(names,rowMeans(sfe))
cut_off<-mean(rowMeans(sfe[-3,]))
sel_cb<-rowMeans(sfe)>cut_off
so<-(sel_cb*1:13)[sel_cb]
so<-c(na.omit(so))
sel_cb<-rowMeans(sfe)<cut_off
st<-(sel_cb*1:13)[sel_cb]
st<-c(na.omit(st))
plot(colMeans(sfe[-3,])) # with out denmark due to missing values
matplot(sfe[-3,],type = 'l')
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type = output)
# corssboarder working and investment flows might correlated
######################## use goverment response index #########################
dcb_raw<-read_xlsx('C:/Users/BongBong/Desktop/nat_ac/OxCGRT_data/OxCGRT_timeseries_all.xlsx',sheet = 'c8_internationaltravel') # international movement restrictions
dcb<-dcb_raw[dcb_raw$country_name %in% names,]   # here alphabetical ordering becomes importand
dcb.2020<-dcb[, -grep("2021", colnames(dcb))]
dcb.q1<-rowMeans(dcb.2020[,c(grep("Jan", colnames(dcb.2020)),grep("Feb", colnames(dcb.2020)),grep("Mar", colnames(dcb.2020)))]==4)
dcb.q2<-rowMeans(dcb.2020[,c(grep("Apr", colnames(dcb.2020)),grep("May", colnames(dcb.2020)),grep("Jun", colnames(dcb.2020)))]==4)
dcb.q3<-rowMeans(dcb.2020[,c(grep("Jul", colnames(dcb.2020)),grep("Aug", colnames(dcb.2020)),grep("Sep", colnames(dcb.2020)))]==4)
dcb.q4<-rowMeans(dcb.2020[,c(grep("Oct", colnames(dcb.2020)),grep("Nov", colnames(dcb.2020)),grep("Dec", colnames(dcb.2020)))]==4)
dta$dcb=0
k=0
for (i in codes[1:obs]) {
k=k+1
dta[dta$nat==i & dta$pit==56,'dcb']=dcb.q1[k]
dta[dta$nat==i & dta$pit==57,'dcb']=dcb.q2[k]
dta[dta$nat==i & dta$pit==58,'dcb']=dcb.q3[k]
dta[dta$nat==i & dta$pit==59,'dcb']=dcb.q4[k]
}
cor(dta[dta$pit>55,-(1:2)])
cor(dta[dta$pit>55 & dta$nat %in% codes[so],-(1:2)])
dcb.reg<-lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta) # year fe do not change anything
stargazer(coeftest(dcb.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
dcb.means=colMeans(dta[dta$dcb>=1/2,-(1:2)],na.rm = TRUE)
ndcb.means=colMeans(dta[dta$dcb<1/2,-(1:2)],na.rm = TRUE)
dcb.bf<-dcb.reg$coefficients['gdp']+dcb.reg$coefficients['gdp:ps']*dcb.means['ps']+dcb.reg$coefficients['gdp:dcb']*dcb.means['dcb']+dcb.reg$coefficients['gdp:dcb:ps']*dcb.means['ps']*dcb.means['dcb']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been closed", dcb.bf)
ndcb.bf<-dcb.reg$coefficients['gdp']+dcb.reg$coefficients['gdp:ps']*ndcb.means['ps']+dcb.reg$coefficients['gdp:dcb']*ndcb.means['dcb']+dcb.reg$coefficients['gdp:dcb:ps']*ndcb.means['ps']*ndcb.means['dcb']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been open", ndcb.bf)
# alternative explaination, countries with less benefit from cross border traffic are more likely to close borders
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*dcb,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
# sort(lm.influence(dcb.reg)$coefficients[,'gdp:dcb'],decreasing = TRUE)
###### redo exercise for internal movement restrictions ###############################################################
######################## use goverment response index #########################
mr_raw<-read_xlsx('C:/Users/BongBong/Desktop/nat_ac/OxCGRT_data/OxCGRT_timeseries_all.xlsx',sheet = 'c7_movementrestrictions') # movement restrictions
mr<-mr_raw[mr_raw$country_name %in% names,]   # here alphabetical ordering becomes importand
mr.2020<-mr[, -grep("2021", colnames(mr))]
mr.q1<-rowMeans(mr.2020[,c(grep("Jan", colnames(mr.2020)),grep("Feb", colnames(mr.2020)),grep("Mar", colnames(mr.2020)))]==2)
mr.q2<-rowMeans(mr.2020[,c(grep("Apr", colnames(mr.2020)),grep("May", colnames(mr.2020)),grep("Jun", colnames(mr.2020)))]==2)
mr.q3<-rowMeans(mr.2020[,c(grep("Jul", colnames(mr.2020)),grep("Aug", colnames(mr.2020)),grep("Sep", colnames(mr.2020)))]==2)
mr.q4<-rowMeans(mr.2020[,c(grep("Oct", colnames(mr.2020)),grep("Nov", colnames(mr.2020)),grep("Dec", colnames(mr.2020)))]==2)
dta$mr=0
k=0
for (i in codes[1:obs]) {
k=k+1
dta[dta$nat==i & dta$pit==56,'mr']=mr.q1[k]
dta[dta$nat==i & dta$pit==57,'mr']=mr.q2[k]
dta[dta$nat==i & dta$pit==58,'mr']=mr.q3[k]
dta[dta$nat==i & dta$pit==59,'mr']=mr.q4[k]
}
cor(dta[dta$pit>55,-(1:2)])
cor(dta[dta$pit>55 & dta$nat %in% codes[so],-(1:2)])
mr.reg<-lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta) # year fe do not change anything
stargazer(coeftest(mr.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
mr.means=colMeans(dta[dta$mr>=1/2,-(1:2)],na.rm = TRUE)
nmr.means=colMeans(dta[dta$mr<1/2,-(1:2)],na.rm = TRUE)
mr.bf<-mr.reg$coefficients['gdp']+mr.reg$coefficients['gdp:ps']*mr.means['ps']+mr.reg$coefficients['gdp:mr']*mr.means['mr']+mr.reg$coefficients['gdp:mr:ps']*mr.means['ps']*mr.means['mr']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been closed", mr.bf)
nmr.bf<-mr.reg$coefficients['gdp']+mr.reg$coefficients['gdp:ps']*nmr.means['ps']+mr.reg$coefficients['gdp:mr']*nmr.means['mr']+mr.reg$coefficients['gdp:mr:ps']*nmr.means['ps']*nmr.means['mr']
sprintf("in our sample this implies a mean beta_f of %s for those observations where borders have been open", nmr.bf)
# alternative explaination, countries with less benefit from cross border traffic are more likely to close borders
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mr*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+ps+gdp*mr,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm(con~factor(nat)+ic+gdp*mr*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
# for fgl_us
mr.reg<-lm(inc~factor(nat)+ic+gdp*mr*ps,data=dta) # year fe do not change anything
stargazer(coeftest(mr.reg,vcovCL,cluster=dta[,c('nat','year')]),type = output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('share of foreign workers above mean','share of foreign workers below mean','all'))
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high share of foreign workers','low share of foreign worker','all'))
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high share of foreign workers','low share of foreign workers','all'))
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output)
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * share of days with closed borders * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high share of foreign workers','low share of foreign workers','all'))
output='latex' # latex or text in console
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*mc*ps,data=dta[dta$nat %in% codes[-3],]),vcovCL,cluster=dta[dta$nat %in% codes[-3],c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('high share of foreign workers','low share of foreign workers','all'))
stargazer(coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[so],]),vcovCL,cluster=dta[dta$nat %in% codes[so],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta[dta$nat %in% codes[st],]),vcovCL,cluster=dta[dta$nat %in% codes[st],c('nat','year')]),coeftest(lm((gdp-gni)~factor(nat)+ic+gdp*dcb*ps,data=dta),vcovCL,cluster=dta[,c('nat','year')]),type=output,title = 'OLS: (GDP - GNI) = country fixed effects + incidence + GDP * share of days with closed borders * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('many foreign workers','few foreign workers','all'))
source('C:/Users/BongBong/Desktop/nat_ac/permanent_component.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp.R')
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
output='latex' # latex or text in console
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
stargazer(coeftest(norm.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'),covariate.labels = NA)
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'),covariate.labels = c('gdp_component','mc','ps','ic','gdp_component:mc','gdp_component:ps','mc:ps','gdp_component:mc:ps','Constant'))
output='text'
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'),covariate.labels = c('gdp.component','mc','ps','ic','gdp.component:mc','gdp.component:ps','mc:ps','gdp.component:mc:ps','Constant'))
aaa<-coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')])
aaa$coefficients
aaa
aaa[,-1]
rownames(aaa)
tot=coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')])
per=coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')])
tra=coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')])
rownames(per)=rownames(tot)
rownames(tra)=rownames(tot)
stargazer(tot,per,tra,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
toti=coeftest(norm.i,vcovCL,cluster=dta.p.i[,c('nat','year')])
peri=coeftest(perm.i,vcovCL,cluster=dta.p.i[,c('nat','year')])
trai=coeftest(tran.i,vcovCL,cluster=dta.p.i[,c('nat','year')])
rownames(per)=rownames(tot)
rownames(tra)=rownames(tot)
stargazer(toti,peri,trai,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
toti=coeftest(norm.i,vcovCL,cluster=dta.p.c[,c('nat','year')])
peri=coeftest(perm.i,vcovCL,cluster=dta.p.c[,c('nat','year')])
trai=coeftest(tran.i,vcovCL,cluster=dta.p.c[,c('nat','year')])
rownames(per)=rownames(tot)
rownames(tra)=rownames(tot)
stargazer(toti,peri,trai,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
rownames(per.i)=rownames(tot.i)
rownames(tra.i)=rownames(tot.i)
stargazer(toti,peri,trai,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
rownames(peri)=rownames(toti)
rownames(trai)=rownames(toti)
stargazer(toti,peri,trai,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
output='latex'
stargazer(tot,per,tra,type = output,title = 'OLS: Consumption = country fixed effects + incidence + GDP * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
stargazer(toti,peri,trai,type = output,title = 'OLS: Disposable Income = country fixed effects + incidence + GDP component * covid measures * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
debugSource('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
source('C:/Users/BongBong/Desktop/nat_ac/permanent_comp_usa.R')
stargazer(coeftest(first.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * travel restrictions * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
first.reg=glm(inc~factor(state)+ic+gsp*ps*mc,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(first.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * travel restrictions * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
first.reg=glm(inc~factor(state)+ic+gsp*ps*mr,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(first.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * travel restrictions * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
travel.reg=glm(inc~factor(state)+ic+gsp*ps*mr,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(travel.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * travel restrictions * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
home.reg=glm(inc~factor(state)+ic+gsp*ps*sh,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(home.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * stay at home requirements * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
output='latex'
# 17 travel restrictions within states
travel.reg=glm(inc~factor(state)+ic+gsp*ps*mr,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(travel.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * travel restrictions * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
# 18 obligatory stay at home requirements
home.reg=glm(inc~factor(state)+ic+gsp*ps*sh,data = dta.us,weights=dta.us$pop)
stargazer(coeftest(home.reg,vcovCL,cluster=dta.us[,c('state','year')]),type = output,title = 'WLS: Personal Income = state fixed effects + incidence + GSP * stay at home requirements * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects')
totus=coeftest(normreg.sh,vcovCL,cluster=dta.us.p[,c('state','year')])
perus=coeftest(permreg.sh,vcovCL,cluster=dta.us.p[,c('state','year')])
traus=coeftest(tranreg.sh,vcovCL,cluster=dta.us.p[,c('state','year')])
rownames(perus)=rownames(totus)
rownames(traus)=rownames(totus)
stargazer(totus,perus,traus,type=output,title = 'WLS: Personal Income = country fixed effects + incidence + GDP component * stay at home requirements * policy support',style = 'qje',omit = 'factor',omit.labels = ' State fixed effects',column.labels = c('total','permanent','transitory'))
perm.sh<-lm(inc~factor(nat)+gdp.p*sh*ps+ic,data = dta.p.c)
source('C:/Users/BongBong/Desktop/nat_ac/pre_reg.R')
##########################################################################################
########################## get permanent component of gdp ################################
##########################################################################################
l.gdp_tot=rep(0,60)
for (i in codes) { # log gdp levels seasonal and calendar adjusted
assign(paste("l.gdp",i,sep="_"),get(i)[get(i)$Indicator==row_gdp & is.na(get(i)$`Reference year`)==0,][2,][7:66])
l.gdp_tot=l.gdp_tot+get(paste("l.gdp",i,sep="_"))
assign(paste("l.gdp",i,sep="_"),as.ts(log(t(get(paste("l.gdp",i,sep="_")))),frequency=4,start=c(2006,1),end=c(2020,4)))
assign(paste('ar',i,sep = '_'),arima(get(paste("l.gdp",i,sep="_")),order= c(1,1,0),include.mean = FALSE))
}
l.gdp_tot=as.ts(log(t(l.gdp_tot)),start=c(2006,1),end=c(2020,4))
ar_tot=arima(l.gdp_tot,order = c(1,1,0),include.mean = FALSE  )
l.con_tot=rep(0,60)
for (i in codes) { # log con levels seasonal and calendar adjusted
assign(paste("l.con",i,sep="_"),get(i)[get(i)$Indicator==row_con & is.na(get(i)$`Reference year`)==0,][2,][7:66])
l.con_tot=l.con_tot+get(paste("l.con",i,sep="_"))
assign(paste("l.con",i,sep="_"),as.ts(log(t(get(paste("l.con",i,sep="_")))),frequency=4,start=c(2006,1),end=c(2020,4)))
}
l.con_tot=as.ts(log(t(l.con_tot)),start=c(2006,1),end=c(2020,4))
for (i in c(codes,'tot')){
gdp=diff(get(paste("l.gdp",i,sep="_")))
GDP=diff(l.gdp_tot)
con=diff(get(paste("l.con",i,sep="_")))
CON=diff(get(paste("l.con",i,sep="_"))-l.con_tot)
assign(paste('X',i,sep = '_'),ts.intersect(gdp,GDP,CON))
}
for (i in c(codes,'tot')){
assign(paste('A',i,sep = '_'),Bcoef(VAR(get(paste('X',i,sep = '_')),type = 'none')))
assign(paste('a',i,sep = '_'),cbind(c(get(paste('ar',i,sep = '_'))$coef,0),c(0,ar_tot$coef)))
}
################## helper function to get E[...] #############################
E<-function(A,dx,r){
A=A/(1+r)
return(c(1,-1,0)%*%A%*%solve(diag(3)-A)%*%dx)
}
# E(A_au,X_au[5,],0.02) #try
################# actual calculation of perm gdp comp ########################
r=0.02
for (i in codes) {
helper=NaN*(1:59)
for (z in 1:59) {
helper[z]=get(paste('l.gdp',i,sep='_'))[z+1]-l.gdp_tot[z+1]+E(get(paste('A',i,sep = '_')),get(paste('X',i,sep = '_'))[z,],r)
}
assign(paste('gdp.p',i,sep='_'),diff(helper))
}
################ get data together in a data frame ###########################
t=length(get(paste('gdp.p',codes[1],sep='_')))
dta.p<-data.frame(pit=1:t,'nat'=rep(codes[1],t),'con'=diff(get(paste('l.con',codes[1],sep='_')))[-1]-diff(l.con_tot)[-1],'gdp.p'=get(paste('gdp.p',codes[1],sep='_')),'gdp'=diff(get(paste('l.gdp',codes[1],sep='_')))[-1]-diff(l.gdp_tot)[-1])
for (i in 2:obs) {
tmp=data.frame(pit=1:t,'nat'=rep(codes[i],t),'con'=diff(get(paste('l.con',codes[i],sep='_')))[-1]-diff(l.con_tot)[-1],'gdp.p'=get(paste('gdp.p',codes[i],sep='_')),'gdp'=diff(get(paste('l.gdp',codes[i],sep='_')))[-1]-diff(l.gdp_tot)[-1])
dta.p=rbind(dta.p,tmp)
}
dta.p$gdp.t=dta.p$gdp-dta.p$gdp.p
############### first regression #############################################
dta.p.s=dta.p[dta.p$pit>0,] # >0 full sample -- >54 covid -- <55 non-covid
perm<-lm(con~factor(nat)+gdp.p,data = dta.p.s)
tran<-lm(con~factor(nat)+gdp.t,data = dta.p.s)
norm<-lm(con~factor(nat)+gdp,data = dta.p.s)
stargazer(norm,perm,tran,type = 'text')
stargazer(coeftest(norm,vcovCL,cluster=dta.p.s$nat),coeftest(perm,vcovCL,cluster=dta.p.s$nat),coeftest(tran,vcovCL,cluster=dta.p.s$nat),type = 'text',omit = 'factor',omit.labels = 'Country fixed effects?')
############# developments over time #########################################
b.perm=c()
b.tran=c()
b.norm=c()
for(i in 4:58){
reg.norm<-lm(con~factor(nat)+gdp,data = dta.p[dta.p$pit %in% (i-3):i,])
b.norm[i-3]=reg.norm$coefficients['gdp']
reg.perm<-lm(con~factor(nat)+gdp.p,data = dta.p[dta.p$pit %in% (i-3):i,])
b.perm[i-3]=reg.perm$coefficients['gdp.p']
reg.tran<-lm(con~factor(nat)+gdp.t,data = dta.p[dta.p$pit %in% (i-3):i,])
b.tran[i-3]=reg.tran$coefficients['gdp.t']
}
plot(seq(as.Date("2007/4/1"), as.Date("2020/12/31"), by = "quarter"),b.norm,type='b',col='red',ylim=c(-1,1),xlab='Time',ylab='beta')
lines(seq(as.Date("2007/4/1"), as.Date("2020/12/31"), by = "quarter"),b.perm,type = 'b',col = 'blue')
lines(seq(as.Date("2007/4/1"), as.Date("2020/12/31"), by = "quarter"),b.tran,type = 'b',col='yellow')
title('beta_u (red), beta_perm (blue) and beta_tran (yellow)')
###############
# adding the control variables
###############
c.dta=dta[dta$pit!=1,]
c.dta$nat==dta.p$nat
dta.p.c=data.frame(dta.p,'mc'=c.dta$mc,'ps'=c.dta$ps,'ic'=c.dta$ic,'sh'=c.dta$sh)
############## rerunning regressions with intersections #######################
# consumption
perm.c<-lm(con~factor(nat)+gdp.p*mc*ps+ic,data = dta.p.c)
tran.c<-lm(con~factor(nat)+gdp.t*mc*ps+ic,data = dta.p.c)
norm.c<-lm(con~factor(nat)+gdp*mc*ps+ic,data = dta.p.c)
stargazer(norm.c,perm.c,tran.c,type = 'text')
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c$nat),coeftest(perm.c,vcovCL,cluster=dta.p.c$nat),coeftest(tran.c,vcovCL,cluster=dta.p.c$nat),type = 'text',omit = 'factor',omit.labels = 'Country fixed effects?')
# income
dta.p.c=data.frame(dta.p.c,'inc'=c.dta$inc)
perm.i<-lm(inc~factor(nat)+gdp.p*mc*ps+ic,data = dta.p.c)
tran.i<-lm(inc~factor(nat)+gdp.t*mc*ps+ic,data = dta.p.c)
norm.i<-lm(inc~factor(nat)+gdp*mc*ps+ic,data = dta.p.c)
stargazer(norm.i,perm.i,tran.i,type = 'text')
stargazer(coeftest(norm.i,vcovCL,cluster=dta.p.c$nat),coeftest(perm.i,vcovCL,cluster=dta.p.c$nat),coeftest(tran.i,vcovCL,cluster=dta.p.c$nat),type = 'text',omit = 'factor',omit.labels = 'Country fixed effects?')
# cluster additionally on year level
year<-function(vec,start=1,sq=1){
vec=vec+sq-1
return(vec/4-(vec%%4)/4+start)
}
# year(dta$pit,start=2006)
dta.p.c=data.frame(dta.p.c,'year'=year(dta.p.c$pit,start = 2006,sq=2))
stargazer(coeftest(norm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.c,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = 'text',omit = 'factor',omit.labels = 'Country fixed effects?')
stargazer(coeftest(norm.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(perm.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),coeftest(tran.i,vcovCL,cluster=dta.p.c[,c('nat','year')]),type = 'text',omit = 'factor',omit.labels = 'Country fixed effects?')
# for comparison with us data
perm.sh<-lm(inc~factor(nat)+gdp.p*sh*ps+ic,data = dta.p.c)
tran.sh<-lm(inc~factor(nat)+gdp.t*sh*ps+ic,data = dta.p.c)
norm.sh<-lm(inc~factor(nat)+gdp*sh*ps+ic,data = dta.p.c)
totsh=coeftest(norm.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
persh=coeftest(perm.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
trash=coeftest(tran.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
rownames(persh)=rownames(totsh)
rownames(trash)=rownames(totsh)
stargazer(totsh,persh,trash,type = output,title = 'OLS: Disposable Income = country fixed effects + incidence + GDP component * stay home requirements * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
output='latex'
totsh=coeftest(norm.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
persh=coeftest(perm.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
trash=coeftest(tran.sh,vcovCL,cluster=dta.p.c[,c('nat','year')])
rownames(persh)=rownames(totsh)
rownames(trash)=rownames(totsh)
stargazer(totsh,persh,trash,type = output,title = 'OLS: Disposable Income = country fixed effects + incidence + GDP component * stay home requirements * policy support',style = 'qje',omit = 'factor',omit.labels = ' Country fixed effects',column.labels = c('total','permanent','transitory'))
